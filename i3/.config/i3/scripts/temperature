#!/usr/bin/env bash
# Lightweight temperature script - reads directly from sysfs

T_WARN=${T_WARN:-70}
T_CRIT=${T_CRIT:-90}
SENSOR_CHIP=${SENSOR_CHIP:-k10temp}
SENSOR_CHIP="${SENSOR_CHIP%%-pci-*}"

# Find hwmon path by name
for hwmon in /sys/class/hwmon/hwmon*/; do
    if [[ "$(cat "${hwmon}name" 2>/dev/null)" == "$SENSOR_CHIP" ]]; then
        HWMON_PATH="$hwmon"
        break
    fi
done

if [[ -z "$HWMON_PATH" ]]; then
    echo "? °C"
    echo "? °C"
    exit 0
fi

temp_raw=$(cat "${HWMON_PATH}temp1_input" 2>/dev/null)
temp=$((temp_raw / 1000))

ICON_EMPTY=$''
ICON_QUARTER=$''
ICON_HALF=$''
ICON_THREE=$''
ICON_FULL=$''

if ((temp < 45)); then
    label="$ICON_EMPTY"
elif ((temp < 55)); then
    label="$ICON_QUARTER"
elif ((temp < 65)); then
    label="$ICON_HALF"
elif ((temp < 75)); then
    label="$ICON_THREE"
else
    label="$ICON_FULL"
fi

echo "${label} ${temp}°C"
echo "${label} ${temp}°C"

if ((temp >= T_CRIT)); then
    echo "#FF0000"
    exit 33
elif ((temp >= T_WARN)); then
    echo "#FFFC00"
fi

exit 0
